<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>JGD QUALITY ‡¶á‡¶®‡ßç‡¶°‡¶æ‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶∏</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;font-family:Arial;background:#f2f6fb;padding:15px}
header{background:#0a4b9c;color:#fff;padding:15px;text-align:center}
section{margin-top:15px;background:#fff;padding:15px;border-radius:8px}
label{font-weight:bold;margin-top:10px;display:block}
select,input{width:100%;padding:8px;margin-top:5px}
button{width:100%;padding:12px;margin-top:15px;background:#25D366;color:#fff;border:none;border-radius:6px;font-size:16px}
#total{margin-top:10px;font-weight:bold;white-space:pre-line}
</style>
</head>

<body>

<header>
  <h2>JGD QUALITY ‡¶á‡¶®‡ßç‡¶°‡¶æ‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶∏</h2>
</header>

<section>

<label>Category</label>
<select id="category">
  <option value="">Select Category</option>
</select>

<label>Type</label>
<select id="type">
  <option value="">Select Type</option>
  <option value="TP">TP</option>
  <option value="OP">OP</option>
  <option value="Zebra">Zebra</option>
</select>

<label>Size</label>
<select id="size">
  <option value="">Select Size</option>
</select>

<label>Price (‚Çπ)</label>
<input type="number" id="price" readonly>

<label>Quantity</label>
<input type="number" id="qty" value="1" min="1">

<div id="total">Subtotal: ‚Çπ0
GST: ‚Çπ0
Total: ‚Çπ0</div>

<button onclick="orderWhatsApp()">Order via WhatsApp</button>

</section>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
// üî• Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyAEiXc3TvBaYg7LZjqjjZSXhTFPzo4eQ9I",
  authDomain: "jgd-quality.firebaseapp.com",
  projectId: "jgd-quality",
  storageBucket: "jgd-quality.firebasestorage.app",
  messagingSenderId: "545706431350",
  appId: "1:545706431350:web:ee429e4f7aa2ab8b372057"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let products = [];
let currentProduct = null;

// Load Products
db.collection("products").where("active","==",true).get()
.then(snapshot=>{
  snapshot.forEach(doc=>{
    products.push(doc.data());
  });
  loadCategories();
});

// Load Categories
function loadCategories(){
  const cats = [...new Set(products.map(p => p.category))];
  category.innerHTML = '<option value="">Select Category</option>';
  cats.forEach(c=>{
    category.innerHTML += `<option value="${c}">${c}</option>`;
  });
}

// Category / Type change
category.onchange = loadSizes;
type.onchange = loadSizes;

// Load Sizes
function loadSizes(){
  size.innerHTML = '<option value="">Select Size</option>';
  price.value = "";
  calculate();

  currentProduct = products.find(p =>
    p.category === category.value &&
    p.type === type.value
  );

  if(!currentProduct) return;

  currentProduct.size.forEach(s=>{
    size.innerHTML += `
      <option value="${s.label}" data-price="${s.price}">
        ${s.label}
      </option>`;
  });
}

// Size select ‚Üí Price
size.onchange = () => {
  const opt = size.selectedOptions[0];
  if(!opt) return;
  price.value = opt.dataset.price || "";
  calculate();
};

qty.oninput = calculate;

// Calculation
function calculate(){
  const sub = (price.value * qty.value) || 0;
  const gst = sub * 0.18;
  const total = sub + gst;
  document.getElementById("total").innerText =
`Subtotal: ‚Çπ${sub}
GST: ‚Çπ${gst.toFixed(2)}
Total: ‚Çπ${total.toFixed(2)}`;
}

// WhatsApp Order
function orderWhatsApp(){
  if(!price.value){
    alert("Select product properly");
    return;
  }

  const sub = price.value * qty.value;
  const gst = sub * 0.18;
  const total = sub + gst;

  const msg =
`*New Order*
Company: JGD QUALITY
Category: ${category.value}
Type: ${type.value}
Size: ${size.value}
Price: ‚Çπ${price.value}
Quantity: ${qty.value}
Subtotal: ‚Çπ${sub}
GST: ‚Çπ${gst.toFixed(2)}
Total: ‚Çπ${total.toFixed(2)}`;

  window.open(
    "https://wa.me/917003764905?text=" + encodeURIComponent(msg),
    "_blank"
  );
}
</script>

</body>
</html>
