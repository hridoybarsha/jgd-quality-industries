<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>JGD QUALITY </title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;font-family:Arial;background:#f2f6fb;padding:15px}
header{background:#0a4b9c;color:#fff;padding:15px;text-align:center}
section{margin-top:15px;background:#fff;padding:15px;border-radius:8px}
label{font-weight:bold;margin-top:10px;display:block}
select,input{width:100%;padding:8px;margin-top:5px}
button{width:100%;padding:12px;margin-top:15px;border:none;border-radius:6px;font-size:16px;cursor:pointer}
#total{margin-top:10px;font-weight:bold;white-space:pre-line}
button.order{background:#25D366;color:#fff;}
button.update{background:#0a4b9c;color:#fff;}
button.logout{background:#dc3545;color:#fff;}
</style>
</head>
<body>

<header>
  <h2>JGD QUALITY </h2>
</header>

<section id="userSection">
<h3>User Order</h3>

<label>Category</label>
<select id="category"><option value="">Select</option></select>

<label>Type</label>
<select id="type">
  <option value="">Select</option>
  <option value="SWR 75mm">SWR 75mm</option>
  <option value="TP">TP</option>
  <option value="OP">OP</option>
  <option value="Zebra">Zebra</option>
</select>

<label>Size</label>
<select id="size"><option value="">Select</option></select>

<label>Price </label>
<input type="number" id="price" readonly>

<label>Quantity</label>
<input type="number" id="qty" value="1" min="1">

<div id="total">Subtotal: 0
GST: 0
Total: 0</div>

<button class="order" onclick="orderWhatsApp()">Order via WhatsApp</button>
</section>

<section id="adminLogin">
<h3>Admin Login</h3>
<input type="email" id="adminEmail" placeholder="Email">
<input type="password" id="adminPass" placeholder="Password">
<button onclick="adminLogin()">Login</button>
</section>

<section id="adminPanel" style="display:none">
<h3>Admin Panel</h3>

<label>Category</label>
<select id="adminCategory"><option value="">Select</option></select>

<label>Type</label>
<select id="adminType">
  <option value="">Select</option>
  <option value="SWR 75mm">SWR 75mm</option
  <option value="TP">TP</option>
  <option value="OP">OP</option>
  <option value="Zebra">Zebra</option>
</select>

<label>Size</label>
<select id="adminSize"><option value="">Select</option></select>

<label>Price </label>
<input type="number" id="adminPrice">

<label>Stock</label>
<input type="number" id="adminStock">

<button class="update" onclick="updateProduct()">Update</button>
<button class="logout" onclick="logoutAdmin()">Logout</button>
</section>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<script>
// ЁЯФС Firebase Config (Your API Key included)
const firebaseConfig = {
  apiKey: "AIzaSyAEiXc3TvBaYg7LZjqjjZSXhTFPzo4eQ9I",
  authDomain: "jgd-quality.firebaseapp.com",
  projectId: "jgd-quality",
  storageBucket: "jgd-quality.appspot.com",
  messagingSenderId: "545706431350",
  appId: "1:545706431350:web:ee429e4f7aa2ab8b372057"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

// GLOBAL
let products = [];

// Load products
function loadProducts(){
  db.collection("products").get().then(snapshot=>{
    products=[];
    snapshot.forEach(doc=>products.push({...doc.data(), id:doc.id}));
    loadUserCategories();
    loadAdminCategories();
  });
}

// User: Categories
function loadUserCategories(){
  let cats=[...new Set(products.map(p=>p.category))];
  const catSelect = document.getElementById("category");
  catSelect.innerHTML='<option value="">Select</option>';
  cats.forEach(c=>catSelect.innerHTML+=`<option value="${c}">${c}</option>`);
}

// Admin: Categories
function loadAdminCategories(){
  let cats=[...new Set(products.map(p=>p.category))];
  const catSelect = document.getElementById("adminCategory");
  catSelect.innerHTML='<option value="">Select</option>';
  cats.forEach(c=>catSelect.innerHTML+=`<option value="${c}">${c}</option>`);
}

// User dropdowns
document.getElementById("category").onchange=()=>{
  let sizes=products.filter(p=>p.category===category.value && p.type===type.value).map(p=>p.size);
  let sizeSelect=document.getElementById("size");
  sizeSelect.innerHTML='<option value="">Select</option>';
  [...new Set(sizes)].forEach(s=>sizeSelect.innerHTML+=`<option value="${s}">${s}</option>`);
  document.getElementById("price").value="";
};

document.getElementById("type").onchange=()=>{
  let sizes=products.filter(p=>p.category===category.value && p.type===type.value).map(p=>p.size);
  let sizeSelect=document.getElementById("size");
  sizeSelect.innerHTML='<option value="">Select</option>';
  [...new Set(sizes)].forEach(s=>sizeSelect.innerHTML+=`<option value="${s}">${s}</option>`);
  document.getElementById("price").value="";
};

document.getElementById("size").onchange=()=>loadPrice();
function loadPrice(){
  let p=products.find(p=>p.category===category.value && p.size===size.value && p.type===type.value);
  if(p) document.getElementById("price").value=p.price;
  calculate();
}

document.getElementById("qty").oninput=calculate;

function calculate(){
  let price=document.getElementById("price").value||0;
  let qty=document.getElementById("qty").value||1;
  let sub=price*qty;
  let gst=sub*0.18;
  let total=sub+gst;
  document.getElementById("total").innerText=
`Subtotal: ${sub}
GST: ${gst.toFixed(2)}
Total: ${total.toFixed(2)}`;
}

// WhatsApp Order
function orderWhatsApp(){
  let price=document.getElementById("price").value;
  if(!price){alert("Select product properly"); return;}
  let qty=document.getElementById("qty").value||1;
  let sub=price*qty;
  let gst=sub*0.18;
  let total=sub+gst;
  let msg=`*New Order*
Company: JGD QUALITY
Category: ${category.value}
Size: ${size.value}
Type: ${type.value}
Price: ${price}
Quantity: ${qty}
Subtotal: ${sub}
GST: ${gst.toFixed(2)}
Total: ${total.toFixed(2)}`;
  window.open("https://wa.me/917003764905?text="+encodeURIComponent(msg),"_blank");
}

// Admin Login
function adminLogin(){
  const email=document.getElementById("adminEmail").value;
  const pass=document.getElementById("adminPass").value;
  auth.signInWithEmailAndPassword(email,pass)
  .then(()=>{
    document.getElementById("adminLogin").style.display="none";
    document.getElementById("adminPanel").style.display="block";
    loadProducts();
  })
  .catch(e=>alert("Login Error\n"+e.message));
}

// Admin Logout
function logoutAdmin(){
  auth.signOut().then(()=>{
    document.getElementById("adminPanel").style.display="none";
    document.getElementById("adminLogin").style.display="block";
  });
}

// Admin dropdowns
document.getElementById("adminCategory").onchange=updateAdminSizeOptions;
document.getElementById("adminType").onchange=updateAdminSizeOptions;
function updateAdminSizeOptions(){
  let sizes=products.filter(p=>p.category===adminCategory.value && p.type===adminType.value).map(p=>p.size);
  let sizeSelect=document.getElementById("adminSize");
  sizeSelect.innerHTML='<option value="">Select</option>';
  [...new Set(sizes)].forEach(s=>sizeSelect.innerHTML+=`<option value="${s}">${s}</option>`);
  document.getElementById("adminPrice").value="";
  document.getElementById("adminStock").value="";
}

// Admin: Load price/stock
document.getElementById("adminSize").onchange=()=> {
  let p=products.find(p=>p.category===adminCategory.value && p.type===adminType.value && p.size===adminSize.value);
  if(p){
    document.getElementById("adminPrice").value=p.price;
    document.getElementById("adminStock").value=p.stock;
  }
}

// Admin Update
function updateProduct(){
  let p=products.find(p=>p.category===adminCategory.value && p.type===adminType.value && p.size===adminSize.value);
  if(!p){alert("Select valid product"); return;}
  db.collection("products").doc(p.id).update({
    price:Number(document.getElementById("adminPrice").value),
    stock:Number(document.getElementById("adminStock").value)
  }).then(()=>{alert("Updated"); loadProducts(); });
}

// INIT
loadProducts();
</script>

</body>
</html>






