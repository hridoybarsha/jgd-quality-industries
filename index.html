<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>JGD QUALITY ইন্ডাস্ট্রিস</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:Arial;background:#f2f6fb;padding:15px}
header{background:#0a4b9c;color:#fff;padding:15px;text-align:center}
section{background:#fff;padding:15px;border-radius:8px}
label{font-weight:bold;display:block;margin-top:10px}
select,input{width:100%;padding:8px;margin-top:5px}
button{width:100%;padding:12px;margin-top:15px;background:#25D366;color:#fff;border:none;border-radius:6px;font-size:16px}
#total{margin-top:10px;font-weight:bold;white-space:pre-line}
</style>
</head>

<body>

<header>
<h2>JGD QUALITY ইন্ডাস্ট্রিস</h2>
</header>

<section>

<label>Category</label>
<select id="category"></select>

<label>Type</label>
<select id="type"></select>

<label>Size</label>
<select id="size"></select>

<label>Price (₹)</label>
<input id="price" readonly>

<label>Quantity</label>
<input type="number" id="qty" value="1" min="1">

<div id="total"></div>

<button onclick="orderWhatsApp()">Order via WhatsApp</button>

</section>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAEiXc3TvBaYg7LZjqjjZSXhTFPzo4eQ9I",
  authDomain: "jgd-quality.firebaseapp.com",
  projectId: "jgd-quality"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let products=[], currentProduct=null;

db.collection("products").where("active","==",true).get().then(s=>{
  s.forEach(d=>products.push(d.data()));
  loadCategories();
});

function loadCategories(){
  category.innerHTML='<option value="">Select Category</option>';
  [...new Set(products.map(p=>p.category))].forEach(c=>{
    category.innerHTML+=`<option>${c}</option>`;
  });
}

category.onchange=()=>{
  type.innerHTML='<option value="">Select Type</option>';
  size.innerHTML='<option value="">Select Size</option>';
  price.value="";
  calculate();

  let types=products.filter(p=>p.category===category.value).map(p=>p.type);
  [...new Set(types)].forEach(t=>{
    type.innerHTML+=`<option>${t}</option>`;
  });
};

type.onchange=()=>{
  size.innerHTML='<option value="">Select Size</option>';
  price.value="";
  calculate();

  currentProduct=products.find(p=>p.category===category.value && p.type===type.value);
  if(!currentProduct)return;

  currentProduct.size.forEach(s=>{
    if(s.stock>0){
      size.innerHTML+=`
      <option value="${s.size}" data-price="${s.price}" data-stock="${s.stock}">
        ${s.size} (Stock: ${s.stock})
      </option>`;
    }else{
      size.innerHTML+=`<option disabled>${s.size} (Out)</option>`;
    }
  });
};

size.onchange=()=>{
  let o=size.selectedOptions[0];
  price.value=o.dataset.price;
  qty.max=o.dataset.stock;
  qty.value=1;
  calculate();
};

qty.oninput=calculate;

function calculate(){
  let sub=price.value*qty.value||0;
  let gst=sub*0.18;
  let total=sub+gst;
  totalDiv.innerText=
`Subtotal: ₹${sub}
GST: ₹${gst.toFixed(2)}
Total: ₹${total.toFixed(2)}`;
}

const totalDiv=document.getElementById("total");

function orderWhatsApp(){
  if(!price.value)return alert("Select product properly");

  let sub=price.value*qty.value;
  let gst=sub*0.18;
  let total=sub+gst;

  let msg=`*New Order*
Category: ${category.value}
Type: ${type.value}
Size: ${size.value}
Price: ₹${price.value}
Qty: ${qty.value}
Total: ₹${total.toFixed(2)}`;

  window.open("https://wa.me/917003764905?text="+encodeURIComponent(msg));
}
</script>

</body>
</html>
