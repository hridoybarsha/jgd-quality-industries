<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>JGD QUALITY ইন্ডাস্ট্রিস</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:Arial;background:#f2f6fb;padding:15px}
header{background:#0a4b9c;color:#fff;padding:15px;text-align:center}
section{margin-top:15px;background:#fff;padding:15px;border-radius:8px}
label{font-weight:bold;margin-top:10px;display:block}
select,input{width:100%;padding:8px;margin-top:5px}
button{width:100%;padding:12px;margin-top:15px;background:#25D366;color:#fff;border:none;border-radius:6px;font-size:16px}
#total{margin-top:10px;font-weight:bold;white-space:pre-line}
#loginPanel,#adminPanel{margin-top:20px;padding:15px;background:#fff;border-radius:8px}
#adminPanel{display:none;}
</style>
</head>
<body>

<header><h2>JGD QUALITY ইন্ডাস্ট্রিস</h2></header>

<section id="loginPanel">
<h3>Admin Login</h3>
<label>Email</label><input type="email" id="loginEmail">
<label>Password</label><input type="password" id="loginPass">
<button onclick="adminLogin()">Login</button>
</section>

<section id="adminPanel">
<h3>Admin Panel</h3>
<label>Category</label><select id="adminCategory"><option value="">Select</option></select>
<label>Type</label><select id="adminType"><option value="">Select</option></select>
<label>Size</label><select id="adminSize"><option value="">Select</option></select>
<label>Price</label><input type="number" id="adminPrice">
<label>Stock</label><input type="number" id="adminStock">
<button onclick="updateProduct()">Update</button>
<button style="background:red;color:#fff" onclick="logoutAdmin()">Logout</button>
</section>

<section>
<h3>User Order</h3>
<label>Category</label><select id="category"><option value="">Select Category</option></select>
<label>Type</label><select id="type"><option value="">Select Type</option></select>
<label>Size</label><select id="size"><option value="">Select Size</option></select>
<label>Price (₹)</label><input type="number" id="price" readonly>
<label>Quantity</label><input type="number" id="qty" value="1" min="1">
<div id="total">Subtotal: ₹0
GST: ₹0
Total: ₹0</div>
<button onclick="orderWhatsApp()">Order via WhatsApp</button>
</section>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<script>
// Firebase Config
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

let products = [];

// Load products
function loadProducts(){
  db.collection("products").where("active","==",true).get().then(snap=>{
    products = [];
    snap.forEach(doc=>products.push({...doc.data(),id:doc.id}));
    loadUserDropdown();
    loadAdminDropdown();
  });
}

// User Dropdowns
function loadUserDropdown(){
  const cats=[...new Set(products.map(p=>p.category))];
  category.innerHTML='<option value="">Select Category</option>';
  cats.forEach(c=>category.innerHTML+=`<option value="${c}">${c}</option>`);
}
category.onchange = ()=>{
  const types=[...new Set(products.filter(p=>p.category===category.value).map(p=>p.type))];
  type.innerHTML='<option value="">Select Type</option>'; types.forEach(t=>type.innerHTML+=`<option value="${t}">${t}</option>`);
  size.innerHTML='<option value="">Select Size</option>'; price.value="";
}
type.onchange = ()=>{
  const sizes=[...new Set(products.filter(p=>p.category===category.value && p.type===type.value).map(p=>p.size))];
  size.innerHTML='<option value="">Select Size</option>'; sizes.forEach(s=>size.innerHTML+=`<option value="${s}">${s}</option>`);
}
size.onchange=loadPrice;
function loadPrice(){
  const p = products.find(p=>p.category===category.value && p.type===type.value && p.size===size.value);
  if(p){price.value=p.price;calculate();}
}
qty.oninput=calculate;
function calculate(){
  const sub=price.value*qty.value||0;
  const gst=sub*0.18;
  const total=sub+gst;
  totalDiv=document.getElementById("total");
  totalDiv.innerText=`Subtotal: ₹${sub}\nGST: ₹${gst.toFixed(2)}\nTotal: ₹${total.toFixed(2)}`;
}
function orderWhatsApp(){
  const p = products.find(p=>p.category===category.value && p.type===type.value && p.size===size.value);
  if(!p){alert("Select product properly"); return;}
  if(qty.value>p.stock){alert("Stock exceeded"); return;}
  const sub=p.price*qty.value;
  const gst=sub*0.18;
  const total=sub+gst;
  const msg=`*New Order*\nCompany: JGD QUALITY\nCategory: ${category.value}\nType: ${type.value}\nSize: ${size.value}\nPrice: ₹${p.price}\nQuantity: ${qty.value}\nSubtotal: ₹${sub}\nGST: ₹${gst.toFixed(2)}\nTotal: ₹${total.toFixed(2)}`;
  window.open("https://wa.me/917003764905?text="+encodeURIComponent(msg),"_blank");
}

// Admin
function loadAdminDropdown(){
  const cats=[...new Set(products.map(p=>p.category))];
  adminCategory.innerHTML='<option value="">Select</option>'; cats.forEach(c=>adminCategory.innerHTML+=`<option value="${c}">${c}</option>`);
}
adminCategory.onchange = ()=>{
  const types=[...new Set(products.filter(p=>p.category===adminCategory.value).map(p=>p.type))];
  adminType.innerHTML='<option value="">Select</option>'; types.forEach(t=>adminType.innerHTML+=`<option value="${t}">${t}</option>`);
  adminSize.innerHTML='<option value="">Select</option>'; adminPrice.value=""; adminStock.value="";
}
adminType.onchange = ()=>{
  const sizes=[...new Set(products.filter(p=>p.category===adminCategory.value && p.type===adminType.value).map(p=>p.size))];
  adminSize.innerHTML='<option value="">Select</option>'; sizes.forEach(s=>adminSize.innerHTML+=`<option value="${s}">${s}</option>`);
}
adminSize.onchange = ()=>{
  const p = products.find(p=>p.category===adminCategory.value && p.type===adminType.value && p.size===adminSize.value);
  if(p){adminPrice.value=p.price; adminStock.value=p.stock;}
}
function updateProduct(){
  const p = products.find(p=>p.category===adminCategory.value && p.type===adminType.value && p.size===adminSize.value);
  if(!p){alert("Select product"); return;}
  db.collection("products").doc(p.id).update({price:Number(adminPrice.value),stock:Number(adminStock.value)})
  .then(()=>{alert("Updated"); loadProducts();});
}

// Admin Login
function adminLogin(){
  const email=document.getElementById("loginEmail").value;
  const pass=document.getElementById("loginPass").value;
  auth.signInWithEmailAndPassword(email,pass)
  .then(()=>{loginPanel.style.display="none"; adminPanel.style.display="block"; loadProducts();})
  .catch(err=>alert("Login Error ❌ "+err.message));
}
function logoutAdmin(){auth.signOut(); adminPanel.style.display="none"; loginPanel.style.display="block";}
loadProducts();
</script>

</body>
</html>
